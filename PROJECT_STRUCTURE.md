# 末日房東模擬器 - 專案結構說明 v2.0

## 📊 當前專案狀態：基礎設施完成階段

**重構策略**：直接模組分離重構（已驗證成功）  
**完成度**：70% - 核心基礎設施完成，業務邏輯模組設計完成待實作  
**技術架構**：ES6模組化 + 配置驅動 + 事件通信

## 🏗️ 檔案結構概覽

```
apocalypse-landlord-simulator/
├── README.md                          # ✅ 專案說明文件  
├── PROJECT_STRUCTURE.md               # ✅ 本檔案 - 專案結構追蹤
├── LICENSE                            # 📋 開源授權協議
├── .gitignore                         # 📋 Git版本控制設定
│
├── src/                               # 📁 原始碼目錄
│   ├── index.html                     # 📋 正式版本入口（預留）
│   ├── dev-test.html                  # ✅ 開發測試環境
│   ├── game-refactored.html           # 📦 v1.1穩定版本（備份）
│   ├── index-original.html            # 📦 v1.0原始版本（參考）
│   │
│   ├── js/                           # 🔧 JavaScript模組目錄
│   │   ├── main.js                    # ✅ 應用程式進入點
│   │   │
│   │   ├── core/                     # 🏗️ 核心系統模組（零依賴）
│   │   │   ├── DataManager.js        # ✅ 統一資料管理核心
│   │   │   ├── GameState.js          # ✅ 中央狀態管理系統  
│   │   │   └── EventBus.js           # ✅ 事件通信系統
│   │   │
│   │   ├── systems/                  # 💼 業務系統模組（設計完成）
│   │   │   ├── ResourceManager.js    # 🚀 資源流轉控制（下一目標）
│   │   │   ├── TradeManager.js       # 🚀 統一交易系統
│   │   │   ├── TenantManager.js      # 🚀 租客生命週期管理
│   │   │   ├── SkillManager.js       # 🚀 技能執行管理
│   │   │   └── EventManager.js       # 🚀 事件觸發處理
│   │   │
│   │   ├── ui/                       # 🖥️ 使用者介面模組（最後階段）
│   │   │   ├── UIManager.js          # 📋 介面狀態管理
│   │   │   ├── ModalManager.js       # 📋 彈窗系統管理
│   │   │   ├── DisplayUpdater.js     # 📋 畫面更新邏輯
│   │   │   └── InteractionHandler.js # 📋 使用者互動處理
│   │   │
│   │   └── utils/                    # 🛠️ 工具函數模組
│   │       ├── constants.js          # ✅ 系統級常數定義
│   │       ├── validators.js         # ✅ 輕量驗證系統（存在）
│   │       └── helpers.js            # 📋 配置驅動輔助函數
│   │
│   ├── data/                         # 📊 遊戲配置目錄
│   │   ├── tenants.json              # ✅ 租客類型配置
│   │   ├── skills.json               # ✅ 技能系統配置（20個技能）
│   │   ├── events.json               # ✅ 事件系統配置
│   │   └── rules.json                # ✅ 遊戲規則配置（集中配置）
│   │
│   └── css/                          # 🎨 樣式檔案目錄（未來整理）
│       └── main.css                  # 📋 主要樣式檔案
│
├── docs/                             # 📚 專案文件目錄  
│   ├── architecture.md              # ✅ 架構設計文件（已更新）
│   └── flow-diagrams.md              # ✅ 系統流程圖集（6張圖表）
│
└── tests/                           # 🧪 測試檔案目錄（未來實作）
    └── unit/                        # 單元測試
```

## 📈 重構進度追蹤

### ✅ 已完成：核心基礎設施（100%）

#### 🏗️ 核心系統三劍客
- **DataManager.js** - 統一資料管理核心
  - 並行載入四個配置檔案  
  - 智慧後備模式（配置載入失敗時使用預設值）
  - 統一存取介面：`getGameRules()`, `getTenantTypes()` 等
  - 完整錯誤處理和重試機制

- **GameState.js** - 中央狀態管理系統
  - 深度複製保證狀態不變性
  - 狀態變更歷史追蹤（50條記錄）  
  - 路徑式狀態存取：`getStateValue('resources.cash')`
  - 資源管理輔助方法：`modifyResource()`, `hasEnoughResource()`
  - 完整狀態匯入/匯出功能

- **EventBus.js** - 事件通信系統
  - 標準發布/訂閱模式
  - 一次性監聽和事件過濾
  - 同步/非同步事件發送
  - 完整事件統計和除錯功能
  - 事件歷史記錄（100條記錄）

#### 🛠️ 工具支援系統
- **constants.js** - 系統級常數管理（純技術常數）
- **validators.js** - 輕量驗證系統（可選啟用）
- **main.js** - 應用程式進入點（系統整合協調）
- **dev-test.html** - 開發測試環境（模組化架構驗證）

#### 📊 配置驅動體系
- **rules.json** - 集中遊戲規則配置（擴展版）
- **tenants.json** - 5種租客類型配置
- **skills.json** - 20個技能完整配置
- **events.json** - 四類事件系統配置

### 🚀 下階段目標：業務邏輯模組（30%）

#### 實作優先順序（基於依賴關係）

**第一優先：ResourceManager.js**
- **依賴**：GameState, EventBus
- **職責**：資源流轉控制、閾值監控、轉移驗證
- **重要性**：為交易系統提供基礎，其他模組依賴度高

**第二優先：TradeManager.js**  
- **依賴**：GameState, EventBus, ResourceManager
- **職責**：統一四種交易類型（租金、商人、商隊、互助）
- **重要性**：遊戲核心經濟系統，影響多個業務流程

**第三優先：TenantManager.js**
- **依賴**：GameState, EventBus, ResourceManager, TradeManager  
- **職責**：租客生命週期、滿意度系統、關係管理
- **重要性**：租客相關功能的統一入口

**第四優先：SkillManager.js**
- **依賴**：GameState, EventBus, TenantManager
- **職責**：20個技能的執行邏輯（主動、被動、特殊）
- **複雜度**：中等（技能邏輯、冷卻管理、效果處理）

**第五優先：EventManager.js**
- **依賴**：GameState, EventBus, ResourceManager, TenantManager
- **職責**：四類事件觸發和處理（隨機、衝突、特殊、腳本）
- **複雜度**：最高（動態機率、條件判斷、複雜邏輯）

### 📋 最後階段：UI系統完善（未來）

#### UI模組設計（已規劃）
- **UIManager.js** - 介面狀態管理，統一畫面更新協調
- **ModalManager.js** - 彈窗系統管理，事件選擇介面
- **DisplayUpdater.js** - 畫面更新邏輯，狀態到UI映射  
- **InteractionHandler.js** - 使用者互動處理，按鈕事件綁定

#### 版本規劃與入口檔案
- **dev-test.html** - 開發測試環境，模組整合驗證，系統監控
- **index.html** - 正式版本入口（預留），完整遊戲體驗

## 🎯 技術架構核心特色

### 配置驅動設計
- **集中配置**：所有遊戲參數來自 rules.json
- **智慧後備**：配置載入失敗時自動使用預設值  
- **熱更新支援**：修改配置檔案無需重新部署
- **參數驗證**：validators.js 提供可選驗證機制

### 事件驅動通信
- **模組解耦**：業務模組透過 EventBus 通信
- **統一介面**：標準化的事件發送/監聽機制
- **除錯友善**：完整的事件歷史和統計功能
- **效能最佳化**：事件過濾和節流控制

### 狀態集中管理
- **單一資料源**：GameState 作為唯一真實來源
- **狀態不變性**：深度複製保證狀態安全
- **歷史追蹤**：變更記錄用於除錯和回滾
- **路徑存取**：點記法路徑快速存取嵌套狀態

## 📊 架構品質指標

### 程式碼組織
- **模組獨立性**：每個模組平均 200-400 行，職責單一
- **依賴清晰度**：嚴格單向依賴鏈，零循環依賴
- **介面標準化**：所有模組遵循統一的介面規範
- **文檔完整性**：每個模組有詳細的JSDoc註解

### 系統穩定性
- **錯誤隔離**：單一模組錯誤不影響其他模組運作
- **優雅降級**：配置載入失敗時自動啟用後備模式
- **資源保護**：防止記憶體洩漏和無限迴圈
- **瀏覽器相容**：原生ES6支援，無需額外工具

### 開發效率
- **並行開發**：不同模組可同時開發，依賴明確
- **即時測試**：dev-test.html 提供完整的測試環境  
- **除錯便利**：內建統計、日誌、狀態監控功能
- **快速迭代**：配置驅動設計，參數調整無需改程式碼

## 🚀 部署與維護策略

### GitHub Pages 部署
- **零建置工具**：直接部署ES6模組，無需編譯
- **即時更新**：推送到主分支自動部署
- **版本管理**：Git標籤管理版本，分支管理功能
- **靜態資源**：所有資源透過相對路徑載入

### 維護友善設計
- **配置熱更新**：修改JSON檔案無需重新部署
- **模組獨立更新**：單一模組更新不影響其他功能
- **向下相容性**：新功能不破壞既有功能
- **效能監控**：內建系統狀態監控和統計

## 📅 下階段開發計劃

### 立即目標（1-2個對話）
1. **ResourceManager實作** - 資源流轉控制核心
2. **TradeManager實作** - 統一交易系統框架  
3. **基礎業務邏輯驗證** - 確保核心功能運作

### 中期目標（3-5個對話）
4. **TenantManager實作** - 租客生命週期完整流程
5. **SkillManager實作** - 20個技能的執行邏輯
6. **EventManager實作** - 動態事件系統
7. **完整功能驗證** - 確保所有業務邏輯正常

### 長期目標（後續發展）
8. **UI系統完善** - 現代化使用者介面  
9. **正式版本完成** - index.html 完整遊戲體驗
10. **效能優化** - 載入速度和記憶體使用優化
11. **商業化準備** - 多平台支援和進階功能

---

**專案狀態總結**：核心基礎設施已建構完成並驗證穩定，開發測試環境提供完整的模組整合驗證能力。下階段專注於業務邏輯模組實作，預期在完成ResourceManager和TradeManager後，整體功能完整度將達到90%以上。